var canvas;
var stage;
var footprinturl = "/maps/footprint.png";
var cluearea;
var curBuilding;
var curFloor;
var data = {
   data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:767.7708333333334,y:832.5085853286273},{x:673.4340277777778,y:765.550653438901},{x:636.0729166666667,y:631.6347896594486},{x:633.2708333333334,y:523.8488505198893}]},{mapURL:"maps/mc1.png",pointList:[{x:949.9062500000001,y:551.6169035581418},{x:923.7534722222223,y:521.0912906610703},{x:826.6145833333334,y:521.0912906610703},{x:785.5173611111112,y:582.1425164552132},{x:825.6805555555557,y:632.2045216064104}]},{mapURL:"maps/mc2.png",pointList:[{x:819.1423611111112,y:655.4039874081847}]},{mapURL:"maps/mc3.png",pointList:[{x:692.1145833333334,y:676.1614041781933}]},{mapURL:"maps/mc4.png",pointList:[{x:778.0451388888889,y:727.4444338452734},{x:733.2118055555557,y:706.6870170752647},{x:602.4479166666667,y:706.6870170752647},{x:475.4201388888889,y:706.6870170752647},{x:481.0243055555556,y:549.1748545263761},{x:552.0104166666667,y:497.89182485929604}]}]],id:[1449203718440],feature:[0,3,0,0,false,false,false,1190.0303269288343,true]}
   };
var dataset = [{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:774.6552269835852,y:834.1966612816371},{x:696.6605020634871,y:766.3435648896069},{x:667.813138051944,y:655.7135164243404},{x:599.4342011356937,y:571.6346795907378},{x:693.4552393955379,y:545.0834679590738}]},{mapURL:"maps/dc2.png",pointList:[{x:677.4289260557916,y:568.6845449649974}]},{mapURL:"maps/dc3.png",pointList:[{x:712.6868154032333,y:583.4352180936995},{x:813.1183789989759,y:598.1858912224018},{x:948.8078319421602,y:596.7108239095315},{x:964.8341452819064,y:391.6764674205708},{x:962.6973035032736,y:65.68659127625203},{x:931.7130977130977,y:22.90963920301562}]},{mapURL:"maps/mc4.png",pointList:[{x:5.392186675768765,y:44.70005385029618},{x:68.42901914543705,y:116.38556812062467},{x:173.1342662984454,y:119.69413031771674},{x:168.86058274117974,y:211.23101777059773},{x:475.4973779749899,y:217.8481421647819},{x:478.7026406429391,y:497.9730748519117},{x:547.0815775591894,y:491.35595045772754}]}]],id:[1449207710639],feature:[0,2,0,0,true,false,false,2192.8660262251897,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:774.6552269835852,y:825.3462574044158},{x:689.1815558382722,y:779.6191707054389},{x:657.1289291587799,y:642.4379106085084},{x:758.6289136438389,y:571.6346795907378},{x:914.6183634840351,y:571.6346795907378},{x:919.9604679306171,y:443.30382337102856},{x:911.4131008160858,y:368.0753904146473},{x:947.7394110528438,y:312.0228325255789},{x:897.5236292549724,y:236.79439956919765}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:148.56058584416792,y:79.99138395261174},{x:240.44478232537932,y:200.20247711362413},{x:292.7974059018835,y:142.85406569736134},{x:252.19741210785986,y:61.2428648357566},{x:253.26583299717626,y:142.85406569736134}]},{mapURL:"maps/mc3.png",pointList:[{x:100.4816458249294,y:146.1626278944534}]},{mapURL:"maps/mc4.png",pointList:[{x:140.01321872963663,y:211.23101777059773},{x:243.65004499332855,y:225.56812062466344},{x:478.7026406429391,y:224.46526655896608},{x:473.3605361963571,y:356.8077544426494},{x:484.0447450895212,y:492.4588045234249},{x:554.5605237844044,y:492.4588045234249}]}]],id:[1449207772915],feature:[0,3,0,0,false,false,true,1959.3979127920093,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:786.4078567660657,y:829.7714593430264},{x:870.8131070220622,y:804.6953150242327},{x:908.2078381481366,y:707.3408723747981},{x:930.6446768237812,y:649.8132471728595},{x:813.1183789989759,y:562.7842757135164},{x:614.3920935861235,y:562.7842757135164},{x:716.960498960499,y:595.2357565966613}]},{mapURL:"maps/dc2.png",pointList:[{x:716.960498960499,y:620.3119009154551}]},{mapURL:"maps/dc3.png",pointList:[{x:747.9447047506749,y:595.2357565966613},{x:854.786793682316,y:596.7108239095315},{x:952.0130946101095,y:596.7108239095315},{x:966.9709870605392,y:403.4770059235326},{x:965.9025661712228,y:46.51071620893915},{x:932.781518602414,y:36.18524501884761}]},{mapURL:"maps/mc4.png",pointList:[{x:2.1869240078195302,y:45.802907915993536},{x:113.30269649672634,y:110.87129779213785},{x:162.45005740528129,y:226.6709746903608},{x:373.9973934899308,y:221.15670436187398},{x:477.6342197536227,y:225.56812062466344},{x:477.6342197536227,y:350.19063004846527},{x:482.9763242002048,y:497.9730748519117},{x:551.3552611164552,y:488.04738826063544}]}]],id:[1449207832360],feature:[0,0,2,0,false,false,true,2407.6977506987782,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:767.1762807583702,y:829.7714593430264},{x:625.0763024792875,y:751.5928917609048},{x:504.344741986533,y:741.2674205708132},{x:441.3079095168647,y:741.2674205708132},{x:603.7078846929593,y:702.9156704361875},{x:680.634188723741,y:576.0598815293484},{x:683.8394513916902,y:536.2330640818525}]},{mapURL:"maps/dc2.png",pointList:[{x:680.634188723741,y:568.6845449649974}]},{mapURL:"maps/dc3.png",pointList:[{x:710.5499736246004,y:586.38535271944},{x:839.8289012318862,y:598.1858912224018},{x:953.0815154994259,y:586.38535271944},{x:959.4920408353244,y:422.65288099084546},{x:964.8341452819064,y:236.79439956919765},{x:966.9709870605392,y:53.88605277329026},{x:932.781518602414,y:31.760043080236944}]},{mapURL:"maps/mc4.png",pointList:[{x:2.1869240078195302,y:44.70005385029618},{x:66.29217736680422,y:113.07700592353258},{x:182.7500543022931,y:116.38556812062467},{x:174.2026871877618,y:217.8481421647819},{x:322.71319080274304,y:223.36241249326872},{x:479.77106153225554,y:212.3338718362951},{x:481.90790331088834,y:309.3850296176629},{x:486.181586868154,y:485.84168012924073},{x:542.8078940019238,y:490.25309639203016}]}]],id:[1449207891500],feature:[0,2,0,0,false,false,false,2467.1891020622197,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:768.2447016476867,y:826.821324717286},{x:658.1973500480963,y:729.4668820678514},{x:646.4447202656157,y:599.660958535272},{x:630.4184069258696,y:530.3327948303717}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:172.06584540912897,y:73.37425955842757},{x:212.66583920315261,y:197.9967689822294},{x:320.5763490241102,y:201.30533117932148},{x:524.6447388835448,y:206.8196015078083},{x:818.460483445558,y:205.71674744211094},{x:817.3920625562416,y:355.7049003769521},{x:922.09730970925,y:365.63058696822833}]},{mapURL:"maps/mc3.png",pointList:[{x:689.1815558382722,y:367.83629509962304},{x:676.3605051664753,y:325.92784060312334},{x:777.8604896515344,y:290.63651050080773},{x:679.5657678344245,y:237.6995153473344},{x:712.6868154032333,y:147.2654819601508}]},{mapURL:"maps/mc4.png",pointList:[{x:806.7078536630775,y:211.23101777059773},{x:757.5604927545226,y:290.63651050080773},{x:757.5604927545226,y:439.52180936995154},{x:751.1499674186241,y:710.8239095315024},{x:615.4605144754398,y:704.2067851373182},{x:489.3868495361032,y:704.2067851373182},{x:487.2500077574704,y:554.2186322024771},{x:476.5657988643063,y:501.2816370490038},{x:551.3552611164552,y:499.075928917609}]}]],id:[1449207938716],feature:[0,3,0,0,false,false,false,2754.220186921242,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:772.5183852049523,y:829.7714593430264},{x:598.3657802463772,y:754.5430263866451},{x:414.59738728395445,y:744.2175551965537},{x:602.6394638036429,y:704.3907377490576},{x:677.4289260557916,y:612.9365643511039},{x:813.1183789989759,y:568.6845449649974},{x:925.3025723771992,y:550.9837372105548},{x:912.4815217054022,y:376.9257942918686},{x:962.6973035032736,y:303.1724286483576},{x:948.8078319421602,y:89.28766828217556},{x:909.276259037453,y:73.06192784060313}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:161.38163651596486,y:77.78567582121701},{x:208.392155645887,y:199.09962304792677},{x:283.18161789803577,y:201.30533117932148},{x:258.6079374437583,y:161.60258481421647}]},{mapURL:"maps/mc3.png",pointList:[{x:100.4816458249294,y:151.67689822294022}]},{mapURL:"maps/mc4.png",pointList:[{x:147.49216495485152,y:209.02530963920302},{x:267.15530455828963,y:217.8481421647819},{x:480.839482421572,y:212.3338718362951},{x:474.42895708567346,y:343.5735056542811},{x:481.90790331088834,y:480.3274098007539},{x:560.9710491203028,y:500.1787829833064}]}]],id:[1449207996244],feature:[0,3,0,0,true,false,false,2396.469532826948,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:838.6218632202477},{x:877.2236323579607,y:786.99450726979},{x:925.3025723771992,y:654.2384491114701},{x:803.5025909951282,y:565.7344103392569},{x:713.7552362925497,y:592.2856219709208}]},{mapURL:"maps/dc2.png",pointList:[{x:710.5499736246004,y:609.9864297253636}]},{mapURL:"maps/dc3.png",pointList:[{x:749.0131256399912,y:602.6110931610124},{x:877.2236323579607,y:590.8105546580507},{x:956.2867781673751,y:592.2856219709208},{x:962.6973035032736,y:344.4743134087238},{x:963.76572439259,y:50.93591814754981},{x:928.5078350451485,y:34.71017770597739}]},{mapURL:"maps/mc4.png",pointList:[{x:3.2553448971359416,y:41.39149165320409},{x:48.12902224842523,y:108.66558966074314},{x:168.86058274117974,y:117.48842218632203},{x:170.99742451981257,y:213.43672590199247},{x:474.42895708567346,y:221.15670436187398},{x:484.0447450895212,y:493.56165858912226},{x:554.5605237844044,y:497.9730748519117}]}]],id:[1449208052805],feature:[0,0,2,0,false,false,true,2235.7734555706925,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:768.2447016476867,y:828.2963920301562},{x:605.8447264715921,y:758.9682283252558},{x:435.96580507028267,y:741.2674205708132},{x:606.9131473609085,y:698.4904684975768},{x:658.1973500480963,y:604.0861604738826},{x:636.828932261768,y:530.3327948303717}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:167.79216185186334,y:86.6085083467959},{x:212.66583920315261,y:199.09962304792677},{x:282.1131970087194,y:180.35110393107163},{x:253.26583299717626,y:158.2940226171244}]},{mapURL:"maps/mc3.png",pointList:[{x:127.1921680578397,y:181.453957996769},{x:146.4237440655351,y:314.8992999461497},{x:289.5921432339343,y:325.92784060312334},{x:513.9605299903807,y:322.61927840603124},{x:641.1026158190336,y:327.0306946688207},{x:719.0973407391317,y:245.41949380721593},{x:816.3236416669253,y:263.0651588583737},{x:702.0026065100692,y:330.3392568659128},{x:756.4920718652062,y:384.3791060850835}]},{mapURL:"maps/mc4.png",pointList:[{x:790.6815403233313,y:434.0075390414647},{x:755.4236509758897,y:321.51642434033386},{x:713.7552362925497,y:229.9795368874529},{x:471.22369441772423,y:214.53957996768983},{x:481.90790331088834,y:494.6645126548196},{x:535.3289477767089,y:494.6645126548196}]}]],id:[1449208093426],feature:[0,3,0,0,false,false,false,2783.528424010898,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:813.545718901454},{x:679.5657678344245,y:717.6663435648896},{x:714.8236571818661,y:590.8105546580507}]},{mapURL:"maps/dc2.png",pointList:[{x:716.960498960499,y:611.4614970382338}]},{mapURL:"maps/dc3.png",pointList:[{x:747.9447047506749,y:596.7108239095315},{x:947.7394110528438,y:595.2357565966613},{x:963.76572439259,y:278.09628432956384},{x:965.9025661712228,y:47.985783521809374},{x:938.1236230489961,y:39.13537964458805}]},{mapURL:"maps/mc4.png",pointList:[{x:0.050082229186706795,y:46.9057619816909},{x:127.1921680578397,y:115.2827140549273},{x:170.99742451981257,y:206.8196015078083},{x:348.3552921463369,y:222.25955842757136},{x:475.4973779749899,y:217.8481421647819},{x:481.90790331088834,y:480.3274098007539},{x:557.7657864523536,y:493.56165858912226}]}]],id:[1449208153097],feature:[0,0,2,0,false,false,false,1937.0126297047652,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:829.7714593430264},{x:792.8183821019642,y:747.167689822294},{x:750.0815465293077,y:683.7397953688745},{x:690.2499767275887,y:577.5349488422187},{x:690.2499767275887,y:545.0834679590738}]},{mapURL:"maps/dc2.png",pointList:[{x:675.2920842771589,y:567.2094776521271}]},{mapURL:"maps/dc3.png",pointList:[{x:675.2920842771589,y:601.1360258481423},{x:775.7236478729016,y:593.7606892837911},{x:957.3551990566915,y:598.1858912224018},{x:961.6288826139572,y:298.74722670974694},{x:961.6288826139572,y:37.660312331717826},{x:923.1657305985664,y:37.660312331717826}]},{mapURL:"maps/mc4.png",pointList:[{x:4.323765786452354,y:32.5686591276252},{x:162.45005740528129,y:117.48842218632203},{x:179.54479163434385,y:217.8481421647819},{x:485.11316597883757,y:222.25955842757136},{x:478.7026406429391,y:502.3844911147011},{x:541.7394731126074,y:494.6645126548196}]}]],id:[1449208195308],feature:[0,2,0,0,false,false,false,2128.159653794623,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:840.096930533118},{x:607.9815682502249,y:754.5430263866451},{x:432.76054240233344,y:730.9419493807217},{x:604.7763055822757,y:704.3907377490576},{x:688.1131349489558,y:844.5221324717287}]},{mapURL:"maps/dc2.png",pointList:[{x:669.9499798305768,y:872.5484114162629}]},{mapURL:"maps/dc3.png",pointList:[{x:690.2499767275887,y:860.7478729133011},{x:958.423619946008,y:853.37253634895},{x:960.5604617246407,y:607.0362950996231},{x:963.76572439259,y:301.69736133548736},{x:964.8341452819064,y:46.51071620893915},{x:931.7130977130977,y:31.760043080236944}]},{mapURL:"maps/mc4.png",pointList:[{x:7.529028454401589,y:41.39149165320409},{x:173.1342662984454,y:114.17985998922994},{x:172.06584540912897,y:221.15670436187398},{x:479.77106153225554,y:225.56812062466344},{x:482.9763242002048,y:491.35595045772754},{x:552.4236820057715,y:488.04738826063544}]}]],id:[1449208262781],feature:[0,2,0,0,false,false,false,2740.768990816019,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:834.1966612816371},{x:768.2447016476867,y:704.3907377490576},{x:723.3710242963974,y:620.3119009154551},{x:796.0236447699134,y:564.2593430263867},{x:899.6604710336053,y:673.414324178783},{x:884.7025785831755,y:757.4931610123856},{x:871.8815279113786,y:843.0470651588585}]},{mapURL:"maps/dc2.png",pointList:[{x:833.4183758959878,y:865.1730748519118},{x:606.9131473609085,y:844.5221324717287},{x:318.4395072454774,y:847.4722670974691},{x:184.8868960809259,y:837.1467959073775},{x:178.47637074502745,y:589.3354873451805},{x:320.5763490241102,y:589.3354873451805},{x:429.5552797343842,y:589.3354873451805},{x:606.9131473609085,y:586.38535271944},{x:664.6078753839947,y:573.109746903608}]},{mapURL:"maps/dc3.png",pointList:[{x:664.6078753839947,y:602.6110931610124},{x:866.5394234647965,y:601.1360258481423},{x:961.6288826139572,y:596.7108239095315},{x:965.9025661712228,y:328.24857296715135},{x:966.9709870605392,y:58.31125471190092},{x:941.3288857169454,y:22.90963920301562}]},{mapURL:"maps/mc4.png",pointList:[{x:5.392186675768765,y:39.18578352180937},{x:68.42901914543705,y:106.45988152934841},{x:154.9711111800664,y:111.97415185783522},{x:164.5868991839141,y:325.92784060312334},{x:175.27110807707822,y:590.61281637049},{x:170.99742451981257,y:690.9725363489499},{x:480.839482421572,y:697.5896607431341},{x:479.77106153225554,y:491.35595045772754},{x:551.3552611164552,y:481.43026386645124}]}]],id:[1449208311239],feature:[0,2,0,0,false,false,false,4250.9064762714925,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:775.7236478729016,y:823.8711900915456},{x:664.6078753839947,y:697.0154011847065},{x:627.2131442579204,y:525.9075928917609}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:177.40794985571105,y:658.9897684437265},{x:226.55531076426598,y:589.5099623047927},{x:248.9921494399106,y:635.8298330640819}]},{mapURL:"maps/mc3.png",pointList:[{x:104.75532938219504,y:652.3726440495423}]},{mapURL:"maps/mc4.png",pointList:[{x:147.49216495485152,y:705.3096392030156},{x:317.37108635616096,y:713.0296176628972},{x:481.90790331088834,y:697.5896607431341},{x:478.7026406429391,y:509.0016155088853},{x:551.3552611164552,y:507.89876144318794}]}]],id:[1449208385473],feature:[0,3,0,0,false,false,false,1076.948665683884,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:829.7714593430264},{x:649.649982933565,y:689.6400646203555},{x:718.0289198498153,y:596.7108239095315}]},{mapURL:"maps/dc2.png",pointList:[{x:716.960498960499,y:618.8368336025849}]},{mapURL:"maps/dc3.png",pointList:[{x:737.2604958575107,y:599.660958535272},{x:959.4920408353244,y:592.2856219709208},{x:961.6288826139572,y:251.54507269789985},{x:970.1762497284885,y:53.88605277329026},{x:939.1920439383125,y:50.93591814754981}]},{mapURL:"maps/mc4.png",pointList:[{x:5.392186675768765,y:50.21432417878298},{x:156.0395320693828,y:110.87129779213785},{x:172.06584540912897,y:218.95099623047926},{x:479.77106153225554,y:217.8481421647819},{x:479.77106153225554,y:481.43026386645124},{x:537.4657895553418,y:489.1502423263328}]}]],id:[1449208448279],feature:[0,0,2,0,false,false,false,1999.2612555672822,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:776.7920687622179,y:825.3462574044158},{x:607.9815682502249,y:756.0180936995154},{x:456.26580196729446,y:742.7424878836835},{x:602.6394638036429,y:714.7162089391492},{x:698.79734384212,y:633.587506731287},{x:799.2289074378626,y:561.3092084006463},{x:923.1657305985664,y:556.8840064620356},{x:913.5499425947187,y:394.6266020463113},{x:956.2867781673751,y:309.0726978998385},{x:930.6446768237812,y:109.93861066235866}]},{mapURL:"maps/dc2.png",pointList:[{x:931.7130977130977,y:92.237802907916},{x:931.7130977130977,y:40.61044695745827}]},{mapURL:"maps/mc3.png",pointList:[{x:0.050082229186706795,y:43.597199784598814},{x:99.41322493561299,y:99.84275713516425},{x:137.8763769510038,y:215.6424340333872},{x:145.3553231762187,y:307.1793214862682},{x:377.20265615788,y:335.8535271943996},{x:659.2657709374126,y:327.0306946688207},{x:772.5183852049523,y:372.2477113624125}]},{mapURL:"maps/mc4.png",pointList:[{x:813.1183789989759,y:418.56758212170166},{x:713.7552362925497,y:259.75659666128166},{x:491.5236913147361,y:214.53957996768983},{x:489.3868495361032,y:494.6645126548196},{x:544.9447357805567,y:480.3274098007539}]}]],id:[1449208501634],feature:[0,2,0,0,true,false,false,3085.3949418576435,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:826.821324717286},{x:767.1762807583702,y:711.7660743134088},{x:736.1920749681943,y:636.5376413570275},{x:652.8552456015142,y:583.4352180936995},{x:628.2815651472367,y:525.9075928917609}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:847.3078474571012,y:171.52827140549272},{x:814.1867998882924,y:309.3850296176629},{x:816.3236416669253,y:371.14485729671514},{x:909.276259037453,y:365.63058696822833}]},{mapURL:"maps/mc3.png",pointList:[{x:769.3131225370031,y:376.65912762520196}]},{mapURL:"maps/mc4.png",pointList:[{x:813.1183789989759,y:420.7732902530964},{x:755.4236509758897,y:425.18470651588586},{x:755.4236509758897,y:688.7668282175551},{x:591.9552549104787,y:697.5896607431341},{x:479.77106153225554,y:695.3839526117393},{x:486.181586868154,y:501.2816370490038},{x:556.6973655630371,y:491.35595045772754}]}]],id:[1449208581565],feature:[0,3,0,0,false,false,false,1517.8561132062546,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:820.9210554658051},{x:598.3657802463772,y:748.6427571351643},{x:527.8500015514941,y:763.3934302638665},{x:510.75526732243145,y:903.5248249865375},{x:513.9605299903807,y:705.8658050619279},{x:636.828932261768,y:698.4904684975768},{x:605.8447264715921,y:567.2094776521271},{x:687.0447140596394,y:537.7081313947227}]},{mapURL:"maps/dc2.png",pointList:[{x:679.5657678344245,y:567.2094776521271}]},{mapURL:"maps/dc3.png",pointList:[{x:698.79734384212,y:586.38535271944},{x:958.423619946008,y:587.8604200323102},{x:961.6288826139572,y:278.09628432956384},{x:961.6288826139572,y:43.56058158319871},{x:961.6288826139572,y:43.56058158319871},{x:933.8499394917305,y:25.85977382875606}]},{mapURL:"maps/mc4.png",pointList:[{x:10.734291122350823,y:44.70005385029618},{x:170.99742451981257,y:109.7684437264405},{x:162.45005740528129,y:217.8481421647819},{x:476.5657988643063,y:214.53957996768983},{x:481.90790331088834,y:499.075928917609},{x:541.7394731126074,y:496.8702207862143}]}]],id:[1449208629794],feature:[0,2,0,0,false,false,false,2726.623674821677,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:772.5183852049523,y:823.8606669914523},{x:654.992087380147,y:788.9822401346385},{x:651.7868247121978,y:625.2052792417734},{x:632.5552487045024,y:537.2509854289384}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:160.31321562664846,y:78.55086584879756},{x:210.5289974245198,y:183.993976704017},{x:258.6079374437583,y:164.71942955843926}]},{mapURL:"maps/mc3.png",pointList:[{x:114.37111738604276,y:155.64905443110857}]},{mapURL:"maps/mc4.png",pointList:[{x:168.86058274117974,y:219.1416803224235},{x:477.6342197536227,y:220.27547721333983},{x:481.90790331088834,y:495.78812170601003},{x:554.5605237844044,y:493.5205279241774}]}]],id:[1449210343526],feature:[0,3,0,0,false,false,false,1202.0311172808294,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:761.8341763117882,y:829.9264803578546},{x:891.113103919074,y:773.8177067186324},{x:903.934154590871,y:585.7774923601577},{x:911.4131008160858,y:450.8131449577041},{x:900.7288919229218,y:321.91461092165287}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:166.7237409625469,y:84.21985030337925},{x:218.00794364973467,y:195.3319456131804},{x:308.82371924162965,y:204.4023207405111},{x:259.67635833307475,y:146.57867930377785}]},{mapURL:"maps/mc3.png",pointList:[{x:107.96059205014429,y:151.1138668674432}]},{mapURL:"maps/mc4.png",pointList:[{x:163.51847829459768,y:207.80371141326012},{x:481.90790331088834,y:212.33889897692546},{x:479.77106153225554,y:495.78812170601003},{x:563.1078908989357,y:498.0557154878427}]}]],id:[1449210377109],feature:[0,3,0,0,false,false,false,1568.6976094258848,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:837.5087470658577},{x:895.3867874763397,y:788.9822401346385},{x:906.0709963695037,y:572.1294122857523},{x:927.439414155832,y:164.20346339519023},{x:911.4131008160858,y:86.8643429735595}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:164.5868991839141,y:96.69161610345897},{x:283.18161789803577,y:196.46574250409674},{x:252.19741210785986,y:155.64905443110857}]},{mapURL:"maps/mc3.png",pointList:[{x:114.37111738604276,y:151.1138668674432}]},{mapURL:"maps/mc4.png",pointList:[{x:173.1342662984454,y:219.1416803224235},{x:478.7026406429391,y:236.14863368616858},{x:482.9763242002048,y:476.5135745604323},{x:582.3394669066311,y:516.1964657425041}]}]],id:[1449210412974],feature:[0,3,0,0,false,false,false,1697.3472864099272,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:763.971018090421,y:810.2125869170468},{x:666.7447171626276,y:701.0279463218035},{x:629.3499860365532,y:546.349705478542}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:163.51847829459768,y:93.29022543070995},{x:216.93952276041827,y:194.19814872226405},{x:285.3184596766686,y:196.46574250409674},{x:262.881621001024,y:155.64905443110857}]},{mapURL:"maps/mc3.png",pointList:[{x:104.75532938219504,y:152.24766375835955}]},{mapURL:"maps/mc4.png",pointList:[{x:132.53427250442175,y:206.6699145223438},{x:482.9763242002048,y:211.20510208600913},{x:478.7026406429391,y:500.3233092696754},{x:543.8763148912402,y:500.3233092696754}]}]],id:[1449210444419],feature:[0,3,0,0,false,false,false,1239.2982174107945,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:769.3131225370031,y:811.7290402586475},{x:685.976293170323,y:848.1239204570619}]},{mapURL:"maps/dc2.png",pointList:[{x:696.6605020634871,y:851.1568271402631},{x:960.5604617246407,y:843.5745604322601},{x:968.0394079498557,y:575.1623189689535},{x:966.9709870605392,y:177.85154346959564},{x:925.3025723771992,y:102.02887638956553},{x:931.7130977130977,y:42.887196067142035}]},{mapURL:"maps/mc3.png",pointList:[{x:2.1869240078195302,y:55.87492803047079},{x:138.94479784032023,y:97.82541299437531},{x:109.0290129394607,y:147.71247619469418}]},{mapURL:"maps/mc4.png",pointList:[{x:148.56058584416792,y:205.53611763142743},{x:480.839482421572,y:221.40927410425618},{x:481.90790331088834,y:483.3163559059303},{x:559.9026282309864,y:494.6543248150937}]}]],id:[1449210468486],feature:[0,2,0,0,false,false,false,2041.3791633769222,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:777.8604896515344,y:816.2784002834493},{x:890.0446830297576,y:839.0252004074583}]},{mapURL:"maps/dc2.png",pointList:[{x:862.2657399075309,y:870.8707205810709}]},{mapURL:"maps/dc3.png",pointList:[{x:894.3183665870232,y:861.7720005314674},{x:962.6973035032736,y:851.1568271402631},{x:958.423619946008,y:575.1623189689535},{x:965.9025661712228,y:246.09194384162276},{x:961.6288826139572,y:56.535276141547456},{x:931.7130977130977,y:44.40364940874264}]},{mapURL:"maps/mc4.png",pointList:[{x:5.392186675768765,y:58.14252181230347},{x:176.33952896639462,y:112.56477257628771},{x:172.06584540912897,y:206.6699145223438},{x:479.77106153225554,y:227.07825855883786},{x:485.11316597883757,y:488.985340360512},{x:549.2184193378223,y:493.5205279241774}]}]],id:[1449210496936],feature:[0,2,0,0,false,false,false,1918.946469866692,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:784.2710149874329,y:820.8277603082511},{x:903.934154590871,y:808.6961335754462},{x:906.0709963695037,y:543.3167987953408},{x:916.7552052626679,y:350.72722441206434},{x:930.6446768237812,y:114.16050312237034}]},{mapURL:"maps/dc2.png",pointList:[{x:926.3709932665156,y:126.29212985517516},{x:929.5762559344648,y:44.40364940874264}]},{mapURL:"maps/mc3.png",pointList:[{x:3.2553448971359416,y:54.741131139554454},{x:131.46585161510535,y:98.95920988529164},{x:143.21848139758586,y:195.3319456131804},{x:107.96059205014429,y:154.5152575401922}]},{mapURL:"maps/mc4.png",pointList:[{x:153.90269029074997,y:210.0713051950928},{x:480.839482421572,y:223.67686788608884},{x:490.45527042541966,y:490.11913725142836},{x:531.0552642194433,y:490.11913725142836}]}]],id:[1449210523386],feature:[0,2,0,0,false,false,false,1818.5553693661323,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:779.9973314301672,y:829.9264803578546},{x:682.7710305023737,y:848.1239204570619}]},{mapURL:"maps/dc2.png",pointList:[{x:683.8394513916902,y:876.9365339474733}]},{mapURL:"maps/dc3.png",pointList:[{x:699.8657647314363,y:855.7061871650649},{x:961.6288826139572,y:843.5745604322601},{x:957.3551990566915,y:532.7016254041366},{x:962.6973035032736,y:61.08463616634926},{x:933.8499394917305,y:23.173302626334205}]},{mapURL:"maps/mc4.png",pointList:[{x:1.1185031185031185,y:47.93834979405643},{x:55.60796847364011,y:112.56477257628771},{x:177.40794985571105,y:120.50135081270207},{x:168.86058274117974,y:223.67686788608884},{x:468.018431749775,y:213.47269586784182},{x:479.77106153225554,y:502.59090305150806},{x:555.6289446737208,y:492.386731033261}]}]],id:[1449210551012],feature:[0,2,0,0,false,false,false,2166.496168679002,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:773.5868060942687,y:814.7619469418487},{x:678.4973469451081,y:699.5114929802029},{x:685.976293170323,y:543.3167987953408}]},{mapURL:"maps/dc2.png",pointList:[{x:678.4973469451081,y:567.5800522609504}]},{mapURL:"maps/dc3.png",pointList:[{x:705.2078691780184,y:590.3268523849595},{x:957.3551990566915,y:591.8433057265601},{x:965.9025661712228,y:165.71991673679082},{x:964.8341452819064,y:44.40364940874264},{x:924.2341514878827,y:41.37074272554143}]},{mapURL:"maps/mc4.png",pointList:[{x:4.323765786452354,y:42.26936533947473},{x:163.51847829459768,y:117.09996013995305},{x:173.1342662984454,y:220.27547721333983},{x:486.181586868154,y:224.8106647770052},{x:478.7026406429391,y:481.0487621240976},{x:569.5184162348341,y:495.78812170601003}]}]],id:[1449210578657],feature:[0,2,0,0,false,false,false,2087.1422997243353,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:772.5183852049523,y:831.4429336994552},{x:896.4552083656561,y:796.5645068426414},{x:900.7288919229218,y:558.4813322113469},{x:916.7552052626679,y:371.95757119447273},{x:929.5762559344648,y:117.19340980557155}]},{mapURL:"maps/dc2.png",pointList:[{x:924.2341514878827,y:126.29212985517516},{x:930.6446768237812,y:24.689755967934808},{x:921.0288888199335,y:29.239115992736615},{x:915.6867843733514,y:30.755569334337217},{x:927.439414155832,y:36.821382700739626}]},{mapURL:"maps/mc3.png",pointList:[{x:0.050082229186706795,y:44.53695912130741},{x:135.73953517237098,y:103.494397448957},{x:138.94479784032023,y:53.60733424863812}]},{mapURL:"maps/mc4.png",pointList:[{x:162.45005740528129,y:98.95920988529164},{x:169.92900363049617,y:224.8106647770052},{x:481.90790331088834,y:213.47269586784182},{x:476.5657988643063,y:484.4501527968466},{x:544.9447357805567,y:481.0487621240976}]}]],id:[1449210605310],feature:[0,1,1,0,false,false,false,1916.077558524151,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:776.7920687622179,y:826.8935736746535},{x:664.6078753839947,y:725.2911997874131},{x:715.8920780711825,y:593.3597590681607}]},{mapURL:"maps/dc2.png",pointList:[{x:719.0973407391317,y:619.1394658753709}]},{mapURL:"maps/dc3.png",pointList:[{x:744.7394420827256,y:597.9091190929626},{x:961.6288826139572,y:597.9091190929626},{x:963.76572439259,y:64.11754284955047},{x:929.5762559344648,y:17.107489259931796},{x:927.439414155832,y:42.887196067142035}]},{mapURL:"maps/mc4.png",pointList:[{x:7.529028454401589,y:64.9453031578015},{x:162.45005740528129,y:117.09996013995305},{x:169.92900363049617,y:215.74028964967448},{x:476.5657988643063,y:219.1416803224235},{x:481.90790331088834,y:473.1121838876833},{x:562.0394700096192,y:508.25988750608974}]}]],id:[1449210640015],feature:[0,0,2,0,false,false,false,2038.1561870734008,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:773.5868060942687,y:831.4429336994552},{x:674.2236633878424,y:707.0937596882059},{x:715.8920780711825,y:597.9091190929626}]},{mapURL:"maps/dc2.png",pointList:[{x:722.3026034070809,y:619.1394658753709}]},{mapURL:"maps/dc3.png",pointList:[{x:752.2183883079405,y:593.3597590681607},{x:956.2867781673751,y:593.3597590681607},{x:962.6973035032736,y:42.887196067142035},{x:937.0552021596798,y:33.78847601753842}]},{mapURL:"maps/mc4.png",pointList:[{x:0.050082229186706795,y:44.53695912130741},{x:62.01849380953858,y:109.16338190353869},{x:164.5868991839141,y:135.24071039461447},{x:285.3184596766686,y:210.0713051950928},{x:485.11316597883757,y:231.6134461225032},{x:491.5236913147361,y:483.3163559059303},{x:533.1921059980762,y:485.583949687763}]}]],id:[1449210669175],feature:[0,0,2,0,false,false,false,1889.7002557925598,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:774.6552269835852,y:816.2784002834493},{x:645.3762993762994,y:699.5114929802029},{x:630.4184069258696,y:528.1522653793348}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:166.7237409625469,y:75.14947517604854},{x:229.7605734322152,y:197.59953939501307},{x:297.07108945914916,y:95.55781921254263},{x:291.7289850125671,y:57.008724921387135}]},{mapURL:"maps/mc3.png",pointList:[{x:135.73953517237098,y:66.07910004871783}]},{mapURL:"maps/mc4.png",pointList:[{x:166.7237409625469,y:101.22680366712433},{x:167.79216185186334,y:207.80371141326012},{x:485.11316597883757,y:230.47964923158688},{x:484.0447450895212,y:478.78116834226495},{x:557.7657864523536,y:484.4501527968466}]}]],id:[1449210702510],feature:[0,1,2,0,false,false,false,1392.0543407660323,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:770.3815434263195,y:820.8277603082511},{x:554.5605237844044,y:745.005093228221},{x:473.3605361963571,y:799.5974135258426},{x:521.4394762155956,y:697.9950396386023},{x:662.471033605362,y:670.6988794897915},{x:690.2499767275887,y:540.2838921121396}]},{mapURL:"maps/dc2.png",pointList:[{x:675.2920842771589,y:570.6129589441516}]},{mapURL:"maps/dc3.png",pointList:[{x:706.2762900673348,y:585.7774923601577},{x:939.1920439383125,y:594.8762124097613},{x:957.3551990566915,y:337.0791443376589},{x:960.5604617246407,y:51.98591611674565},{x:925.3025723771992,y:38.33783604234023}]},{mapURL:"maps/mc4.png",pointList:[{x:0.050082229186706795,y:49.072146684972765},{x:169.92900363049617,y:119.36755392178573},{x:167.79216185186334,y:225.94446166792153},{x:482.9763242002048,y:219.1416803224235},{x:479.77106153225554,y:481.0487621240976},{x:551.3552611164552,y:492.386731033261}]}]],id:[1449210759808],feature:[0,2,0,0,false,false,true,2470.547328932289,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:823.8606669914523},{x:896.4552083656561,y:788.9822401346385},{x:924.2341514878827,y:650.9849860489836},{x:885.770999472492,y:550.8990655033439}]},{mapURL:"maps/dc2.png",pointList:[{x:870.8131070220622,y:564.5471455777492}]},{mapURL:"maps/dc3.png",pointList:[{x:874.0183696900115,y:600.9420257761637},{x:964.8341452819064,y:596.392665751362},{x:966.9709870605392,y:305.23362416404626},{x:965.9025661712228,y:51.98591611674565},{x:931.7130977130977,y:44.40364940874264}]},{mapURL:"maps/mc4.png",pointList:[{x:2.1869240078195302,y:27.53000575756234},{x:70.56586092406988,y:114.83236635812038},{x:161.38163651596486,y:122.76894459453474},{x:161.38163651596486,y:222.5430709951725},{x:488.3184286467868,y:213.47269586784182},{x:482.9763242002048,y:486.71774657867934},{x:562.0394700096192,y:492.386731033261}]}]],id:[1449210788995],feature:[0,2,0,0,false,false,true,2022.402452479898,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:777.8604896515344,y:828.410027016254},{x:690.2499767275887,y:837.5087470658577}]},{mapURL:"maps/dc2.png",pointList:[{x:673.155242498526,y:845.0910137738607},{x:962.6973035032736,y:839.0252004074583},{x:965.9025661712228,y:647.9520793657824},{x:1000.092034629348,y:614.5901058505691},{x:964.8341452819064,y:385.60565126887815},{x:970.1762497284885,y:165.71991673679082},{x:925.3025723771992,y:155.10474334558663},{x:924.2341514878827,y:44.40364940874264}]},{mapURL:"maps/mc3.png",pointList:[{x:1.1185031185031185,y:38.86797466672572},{x:156.0395320693828,y:104.62819433987333},{x:101.55006671424582,y:160.1842419947739}]},{mapURL:"maps/mc4.png",pointList:[{x:132.53427250442175,y:208.93750830417645},{x:485.11316597883757,y:215.74028964967448},{x:481.90790331088834,y:499.18951237875905},{x:569.5184162348341,y:498.0557154878427}]}]],id:[1449210818011],feature:[0,2,0,0,false,false,true,2194.856366329957,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:779.9973314301672,y:805.663226892245},{x:660.3341918267291,y:673.7317861729927},{x:632.5552487045024,y:528.1522653793348}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:168.86058274117974,y:81.95225652154657},{x:211.59741831383622,y:195.3319456131804},{x:304.55003568436405,y:210.0713051950928},{x:309.8921401309461,y:568.3511227246556},{x:294.9342476805163,y:671.5266397980424},{x:253.26583299717626,y:632.9775455068869}]},{mapURL:"maps/mc3.png",pointList:[{x:95.13954137834735,y:652.2520926524647}]},{mapURL:"maps/mc4.png",pointList:[{x:157.10795295869923,y:708.9419371982816},{x:335.53424147453995,y:714.6109216528633},{x:489.3868495361032,y:708.9419371982816},{x:485.11316597883757,y:491.25293414234466},{x:543.8763148912402,y:496.9219185969264}]}]],id:[1449210883344],feature:[0,3,0,0,false,false,true,1670.1817765311516,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:829.9264803578546},{x:687.0447140596394,y:840.5416537490589}]},{mapURL:"maps/dc2.png",pointList:[{x:673.155242498526,y:883.0023473138757}]},{mapURL:"maps/dc3.png",pointList:[{x:781.0657523194836,y:861.7720005314674},{x:984.0657212896018,y:839.0252004074583},{x:963.76572439259,y:660.0837060985872},{x:958.423619946008,y:277.9374640152354},{x:965.9025661712228,y:55.018822799946854},{x:940.260464827629,y:53.50236945834625}]},{mapURL:"maps/mc4.png",pointList:[{x:6.460607565085176,y:42.26936533947473},{x:160.31321562664846,y:101.22680366712433},{x:169.92900363049617,y:214.60649275875815},{x:471.22369441772423,y:224.8106647770052},{x:485.11316597883757,y:490.11913725142836},{x:536.3973686660254,y:492.386731033261}]}]],id:[1449210919101],feature:[0,2,0,0,false,false,true,2004.792112572784,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:777.8604896515344,y:816.2784002834493},{x:882.5657368045427,y:828.410027016254}]},{mapURL:"maps/dc2.png",pointList:[{x:871.8815279113786,y:864.8049072146686}]},{mapURL:"maps/dc3.png",pointList:[{x:952.0130946101095,y:861.7720005314674},{x:964.8341452819064,y:620.6559192169716},{x:995.8183510720824,y:614.5901058505691},{x:962.6973035032736,y:482.65866513131675},{x:962.6973035032736,y:65.63399619115107},{x:938.1236230489961,y:47.43655609194384}]},{mapURL:"maps/mc4.png",pointList:[{x:5.392186675768765,y:62.677709375968824},{x:167.79216185186334,y:105.76199123078968},{x:167.79216185186334,y:229.34585234067055},{x:482.9763242002048,y:221.40927410425618},{x:490.45527042541966,y:492.386731033261},{x:557.7657864523536,y:492.386731033261}]}]],id:[1449210947396],feature:[0,2,0,0,false,false,true,1907.33982289859,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:758.6289136438389,y:825.3771203330529},{x:620.8026189220219,y:691.9292262721999},{x:598.3657802463772,y:563.0306922361486},{x:687.0447140596394,y:540.2838921121396}]},{mapURL:"maps/dc2.png",pointList:[{x:665.6762962733112,y:570.6129589441516}]},{mapURL:"maps/dc3.png",pointList:[{x:671.0184007198932,y:600.9420257761637},{x:956.2867781673751,y:593.3597590681607},{x:957.3551990566915,y:61.08463616634926},{x:927.439414155832,y:30.755569334337217}]},{mapURL:"maps/mc4.png",pointList:[{x:11.802712011667236,y:54.741131139554454},{x:164.5868991839141,y:115.96616324903673},{x:162.45005740528129,y:194.19814872226405},{x:476.5657988643063,y:229.34585234067055},{x:474.42895708567346,y:482.18255901501396},{x:529.9868433301269,y:483.3163559059303}]},{mapURL:"maps/dc1.png",pointList:[{x:767.1762807583702,y:825.3771203330529},{x:649.649982933565,y:687.379866247398},{x:594.0920966891116,y:563.0306922361486},{x:685.976293170323,y:544.8332521369414}]},{mapURL:"maps/dc2.png",pointList:[{x:675.2920842771589,y:581.2281323353559}]},{mapURL:"maps/dc3.png",pointList:[{x:669.9499798305768,y:605.4913858009655},{x:959.4920408353244,y:607.0078391425661},{x:966.9709870605392,y:42.887196067142035},{x:926.3709932665156,y:41.37074272554143}]},{mapURL:"maps/mc4.png",pointList:[{x:3.2553448971359416,y:44.53695912130741},{x:53.471126695007285,y:104.62819433987333},{x:184.8868960809259,y:113.69856946720404},{x:162.45005740528129,y:228.21205544975422},{x:482.9763242002048,y:220.27547721333983},{x:476.5657988643063,y:475.37977766951593},{x:544.9447357805567,y:498.0557154878427}]}]],id:[1449210986907,1449210986907],feature:[0,4,0,0,true,false,false,4421.875681094666,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:819.3113069666505},{x:897.5236292549724,y:767.75189335223},{x:913.5499425947187,y:544.8332521369414},{x:914.6183634840351,y:385.60565126887815},{x:953.0815154994259,y:317.3652508968511},{x:925.3025723771992,y:118.70986314717216}]},{mapURL:"maps/dc2.png",pointList:[{x:918.8920470413008,y:129.32503653837637},{x:926.3709932665156,y:47.43655609194384}]},{mapURL:"maps/mc3.png",pointList:[{x:0.050082229186706795,y:43.403162230391075},{x:137.8763769510038,y:96.69161610345897},{x:115.43953827535917,y:163.58563266752293}]},{mapURL:"maps/mc4.png",pointList:[{x:143.21848139758586,y:223.67686788608884},{x:470.1552735284078,y:221.40927410425618},{x:479.77106153225554,y:469.71079321493426},{x:524.6447388835448,y:478.78116834226495}]}]],id:[1449211034029],feature:[0,2,0,0,true,false,false,1719.6248095437832,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:777.8604896515344,y:823.8606669914523},{x:898.5920501442889,y:764.7189866690288},{x:915.6867843733514,y:396.22082466008237},{x:966.9709870605392,y:317.3652508968511},{x:896.4552083656561,y:149.0389299791842}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:149.62900673348435,y:79.6846627397139},{x:281.04477611940297,y:193.06435183134772},{x:261.81320011170754,y:155.64905443110857}]},{mapURL:"maps/mc3.png",pointList:[{x:104.75532938219504,y:145.44488241286152}]},{mapURL:"maps/mc4.png",pointList:[{x:161.38163651596486,y:204.4023207405111},{x:486.181586868154,y:227.07825855883786},{x:480.839482421572,y:468.5769963240179},{x:546.0131566698731,y:477.6473714513486}]}]],id:[1449211063356],feature:[0,3,0,0,true,false,false,1628.4830517429027,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:776.7920687622179,y:825.3771203330529},{x:589.8184131318459,y:748.0379999114222},{x:459.4710646352437,y:748.0379999114222},{x:598.3657802463772,y:701.0279463218035},{x:679.5657678344245,y:590.3268523849595},{x:684.9078722810066,y:544.8332521369414}]},{mapURL:"maps/dc2.png",pointList:[{x:677.4289260557916,y:575.1623189689535}]},{mapURL:"maps/dc3.png",pointList:[{x:667.813138051944,y:610.0407458257673},{x:958.423619946008,y:610.0407458257673},{x:964.8341452819064,y:59.56818282474866},{x:932.781518602414,y:35.304929359139024}]},{mapURL:"maps/mc4.png",pointList:[{x:1.1185031185031185,y:45.67075601222375},{x:177.40794985571105,y:108.02958501262235},{x:157.10795295869923,y:230.47964923158688},{x:477.6342197536227,y:225.94446166792153},{x:480.839482421572,y:479.9149652331813},{x:536.3973686660254,y:483.3163559059303}]}]],id:[1449211104016],feature:[0,2,0,0,false,false,false,2485.060974902943,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:761.8341763117882,y:823.8606669914523},{x:601.5710429143264,y:749.5544532530228},{x:449.855276631396,y:726.8076531290137},{x:601.5710429143264,y:697.9950396386023},{x:631.486827815186,y:516.02063864653}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:129.32900983647252,y:103.494397448957},{x:275.7026716728209,y:194.19814872226405},{x:253.26583299717626,y:145.44488241286152}]},{mapURL:"maps/mc3.png",pointList:[{x:107.96059205014429,y:160.1842419947739}]},{mapURL:"maps/mc4.png",pointList:[{x:140.01321872963663,y:215.74028964967448},{x:140.01321872963663,y:215.74028964967448},{x:494.7289539826853,y:221.40927410425618},{x:486.181586868154,y:483.3163559059303},{x:558.83420734167,y:470.8445901058506}]}]],id:[1449211135547],feature:[0,3,0,0,false,false,false,1585.2973016443007,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:769.3131225370031,y:816.2784002834493},{x:597.2973593570608,y:755.6202666194251},{x:462.6763273031929,y:738.9392798618185},{x:598.3657802463772,y:701.0279463218035},{x:712.6868154032333,y:594.8762124097613}]},{mapURL:"maps/dc2.png",pointList:[{x:723.3710242963974,y:610.0407458257673}]},{mapURL:"maps/dc3.png",pointList:[{x:750.0815465293077,y:597.9091190929626},{x:952.0130946101095,y:599.4255724345632},{x:964.8341452819064,y:45.92010275034324},{x:940.260464827629,y:33.78847601753842}]},{mapURL:"maps/mc4.png",pointList:[{x:7.529028454401589,y:62.677709375968824},{x:153.90269029074997,y:117.09996013995305},{x:168.86058274117974,y:225.94446166792153},{x:496.8657957613181,y:222.5430709951725},{x:480.839482421572,y:481.0487621240976},{x:544.9447357805567,y:483.3163559059303}]}]],id:[1449211170347],feature:[0,0,2,0,false,false,false,2315.1363949132133,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:781.0657523194836,y:840.5416537490589},{x:644.3078784869829,y:661.6001594401878},{x:625.0763024792875,y:514.5041853049294},{x:582.3394669066311,y:523.6029053545329},{x:637.8973531510844,y:529.6687187209354}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:150.69742762280075,y:74.01567828513221},{x:261.81320011170754,y:195.3319456131804},{x:252.19741210785986,y:156.7828513220249}]},{mapURL:"maps/mc3.png",pointList:[{x:129.32900983647252,y:189.6629611585987},{x:135.73953517237098,y:315.51441605031226},{x:388.95528594036057,y:317.7820098321449},{x:636.828932261768,y:334.78896319589},{x:797.0920656592298,y:270.16254041365875},{x:678.4973469451081,y:228.21205544975422},{x:705.2078691780184,y:148.84627308561053}]},{mapURL:"maps/mc4.png",pointList:[{x:739.3973376361436,y:281.5005093228221},{x:637.8973531510844,y:227.07825855883786},{x:478.7026406429391,y:227.07825855883786},{x:487.2500077574704,y:485.583949687763},{x:535.3289477767089,y:487.85154346959564}]}]],id:[1449211200483],feature:[0,3,0,0,false,false,false,2268.5695347637384,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:770.3815434263195,y:829.9264803578546},{x:638.9657740404009,y:650.9849860489836},{x:630.4184069258696,y:512.9877319633288},{x:625.0763024792875,y:525.1193586961336}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:164.5868991839141,y:74.01567828513221},{x:286.38688056598505,y:190.79675804951503},{x:261.81320011170754,y:149.98006997652686}]},{mapURL:"maps/mc3.png",pointList:[{x:104.75532938219504,y:151.1138668674432}]},{mapURL:"maps/mc4.png",pointList:[{x:160.31321562664846,y:214.60649275875815},{x:489.3868495361032,y:216.8740865405908},{x:481.90790331088834,y:488.985340360512},{x:547.0815775591894,y:486.71774657867934}]}]],id:[1449211239688],feature:[0,3,0,0,false,false,false,1256.4226298605868,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:771.449964315636,y:829.9264803578546},{x:897.5236292549724,y:737.4228265202179},{x:922.09730970925,y:552.4155188449445},{x:930.6446768237812,y:189.98317020240046},{x:899.6604710336053,y:86.8643429735595}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:168.86058274117974,y:83.08605341246292},{x:288.52372234461785,y:199.86713317684575},{x:289.5921432339343,y:60.410115594136144}]},{mapURL:"maps/mc3.png",pointList:[{x:143.21848139758586,y:54.741131139554454}]},{mapURL:"maps/mc4.png",pointList:[{x:175.27110807707822,y:119.36755392178573},{x:169.92900363049617,y:201.00093006776208},{x:468.018431749775,y:224.8106647770052},{x:481.90790331088834,y:490.11913725142836},{x:524.6447388835448,y:481.0487621240976}]}]],id:[1449211268641],feature:[0,1,2,0,false,false,false,1810.0804208291197,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:778.9289105408508,y:822.3442136498517},{x:896.4552083656561,y:751.0709065946234},{x:910.3446799267695,y:484.17511847291735},{x:899.6604710336053,y:320.39815758005227}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:788.5446985446985,y:162.4518357766066},{x:816.3236416669253,y:280.36671243190574},{x:829.1446923387222,y:373.3380574870455},{x:910.3446799267695,y:364.2676823597148}]},{mapURL:"maps/mc3.png",pointList:[{x:765.0394389797375,y:371.07046370521283}]},{mapURL:"maps/mc4.png",pointList:[{x:782.1341732088,y:433.42929270561143},{x:753.286809197257,y:288.30329066832013},{x:690.2499767275887,y:223.67686788608884},{x:479.77106153225554,y:220.27547721333983},{x:485.11316597883757,y:493.5205279241774},{x:566.3131535668849,y:496.9219185969264}]}]],id:[1449211301040],feature:[0,3,0,0,false,false,false,1668.849132936933,true]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:768.2447016476867,y:822.3442136498517},{x:657.1289291587799,y:687.379866247398},{x:632.5552487045024,y:514.5041853049294},{x:601.5710429143264,y:544.8332521369414},{x:619.7341980327054,y:523.6029053545329}]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[]},{mapURL:"maps/dc1.png",pointList:[]},{mapURL:"maps/mc1.png",pointList:[]},{mapURL:"maps/mc2.png",pointList:[{x:850.5131101250504,y:157.91664821294123},{x:817.3920625562416,y:237.2824305770849},{x:816.3236416669253,y:362.00008857788214},{x:919.9604679306171,y:365.40147925063116}]},{mapURL:"maps/mc3.png",pointList:[{x:768.2447016476867,y:374.47185437796185}]},{mapURL:"maps/mc4.png",pointList:[{x:807.7762745523939,y:431.1616989237788},{x:751.1499674186241,y:359.7324947960494},{x:711.6183945139169,y:229.34585234067055},{x:481.90790331088834,y:218.00788343150717},{x:479.77106153225554,y:487.85154346959564},{x:556.6973655630371,y:487.85154346959564}]}]],id:[1449211342015],feature:[0,4,0,1,false,false,false,1539.313436868606,false]}},{data:{paths:[[{mapURL:"maps/dc1.png",pointList:[{x:775.7236478729016,y:837.5087470658577},{x:887.9078412511248,y:831.4429336994552}]},{mapURL:"maps/dc2.png",pointList:[{x:869.7446861327458,y:870.8707205810709}]},{mapURL:"maps/dc3.png",pointList:[{x:890.0446830297576,y:857.2226405066655},{x:949.8762528314767,y:852.6732804818637},{x:969.107828839172,y:459.9118650073077},{x:968.0394079498557,y:65.63399619115107},{x:934.9183603810469,y:24.689755967934808},{x:905.0025754801874,y:44.40364940874264},{x:924.2341514878827,y:36.821382700739626}]},{mapURL:"maps/mc4.png",pointList:[{x:2.1869240078195302,y:55.87492803047079},{x:174.2026871877618,y:108.02958501262235},{x:162.45005740528129,y:213.47269586784182},{x:485.11316597883757,y:218.00788343150717},{x:481.90790331088834,y:490.11913725142836},{x:542.8078940019238,y:476.5135745604323}]}]],id:[1449211413171],feature:[0,2,0,0,false,false,false,2012.0975692650022,true]}}];
var exited = false;
var nearlift = false;
var nearstair = false;
var nearexit = false;
var nearhall = false;
//mcx: x-1, dcx: x+3
var stairsList = [[[253.34592847039806,126.16112970369765],[877.1896679463864,119.76165211003183],[823.8498686603353,137.1316627214105],[869.0727419680743,215.75381601501917],[921.2529804000808,310.8317688351971],[1018.6560921398262,522.9287405109786],[835.4454772007813,632.634070688107],[239.43119822186299,618.0066933311566],[138.54940391998383,303.51808015672185],[201.16569003839157,127.98955187331646],[491.0559035495386,348.31442331238264],[870.2323028221189,216.66802709982858]],
                  [[129.125841146334,318.796992481203],[252.18636761635346,149.01640682393273],[835.4454772007813,148.10219573912332],[913.1360544217687,364.7702228389519],[820.3711860982016,656.4035588931515],[251.02680676230887,644.5188147906293]],
                  [[106.08170000673536,150.84482899355154],[710.2129049639658,151.75904007836093],[770.5100693742843,375.74075585666475],[691.6599312992523,673.7735695045302],[103.76257829864619,660.0604032323891]],
                  [[136,761.33],[796.53,767.34],[124.63467367144877,168.2148396049302],[821.5307469522462,168.2148396049302],[851.6793291574055,444.30658721736995]],
                  [[340.9647481933025,882.6638023630505],[338.62828965969624,488.453276047261],[78.50257291819817,504.54350161117077],[73.05083633978354,878.0665950590762],[690.5003704452077,546.3978450738715],[688.1812487371186,841.2570402416129],[885.3065939246985,844.0519141294587],[886.4661547787432,547.7952820177944],[927.0507846703038,118.78214023345032],[976.911901394221,191.44886131744346],[980.3905839563548,519.8465431393355],[981.5501448103994,866.4109052322259],[980.3905839563548,990.782793241368]],
                  [[66.65663096921936,533.820912578565],[65.49707011517478,913.923761325606],[128.11335623358255,874.7955268957636],[339.15343166969757,916.7186352134519],[392.49323095574863,877.5904007836094],[576.8634067488381,825.8852338584605],[671.9473967804944,874.7955268957636],[870.2323028221189,877.5904007836094],[997.7839967670236,1025.7187168394416],[1000.1031184751128,905.5391396620684],[998.9435576210682,543.6029711860256],[1000.1031184751128,209.61554158844174],[946.7633191890617,117.38470328952738],[870.2323028221189,567.3593992327156],[671.9473967804944,565.9619622887927],[576.8634067488381,619.0645661578646],[394.81235266383777,571.5517100644845],[339.15343166969757,535.2183495224879]],
                  [[71.49319731737936,533.2760472610097],[66.82028025016682,917.1428571428571],[90.96368509743161,874.6186895810956],[341.7435677045046,537.8732545649839],[371.33870913018404,575.8002148227712],[338.62828965969624,917.1428571428571],[364.3293335293652,875.7679914070892],[567.6012259531108,624.0708915145005],[563.7071283971003,833.2438238453276],[658.7231087637552,574.6509129967776],[664.1748453421699,883.813104189044],[871.3408353219259,873.469387755102],[869.0043767883195,581.546723952739],[991.2790400470477,541.3211600429646],[989.7214010246436,210.32223415682063],[985.8273034686331,907.9484425349087],[996.7307766254623,1026.3265306122448]]
                  ];
var liftList = [[[288.1327540917357,40.22528773161374],[319.4408971509396,40.22528773161374],[763.5527042500169,696.6288466247653],[792.5417256011315,697.5430577095747]],
                [[284.65407152960194,56.681087258183],[314.80265373476124,58.50950942780181]],
                [[142.0280864821176,59.42372051261121],[169.8575469791877,59.42372051261121],[660,751]],
                [[168.69798612514313,63.08056485184883],[202.32525089243617,62.16635376703942]],
                [[712.5320266720549,598.1030119990204]],
                [[725.2871960665454,621.8594400457105]],
                [[710.1251965030932,620.6229860365198]]];
var exitList = [[[881.8279113625648,128.90376295812587],[1022.1347747019599,526.5855848502163],[178.654,126.315]],
                [[891.5901426131802,674.5435016111708],[204.64437260052534,77.70794220879928],[195.36788576816863,142.61692923026692],[878.349228800431,132.56060729736348],[979.2310231023102,363.8560117541425],[1037.2090658045397,548.526650885642],[213.92085943288205,661.8888254020079]],
                [[30,47]],
                [[13,37]],
                [[1009.1918888046957,567.7551020408164],[627.8840843268,855.2314096808424],[625.5649626187109,532.423475634642],[997.7839967670236,831.4749816341523],[903.859567589412,311.62843849481675],[903,241],[903.859567589412,160.70524855113868],[905.0191284434566,81.05134274753081]],
                [[926.63,48.72]],
                [[935,40]]
                ];
var tim_hortons = [[],[],[],[],[[970.0893719806763,312.5193098072562],[590.6304347826086,553.936543367347]],[],[]];
var printer = [[],[],[],[],[[392.45410628019323,694.6621669501134]],[],[]];
var bathroom = [[[970.7391304347825,545.6774376417234],[827.1425120772947,700.7794784580499],[303.43719806763283,653.6139455782313],[255.3550724637681,46.81122448979592],[793.3550724637681,109.39625850340136]],
[[239.76086956521738,63.13775510204081],[791.4057971014493,117.55952380952381],[826.4927536231884,727.9903628117913],[293.69082125603865,670.8475056689342]],
[[102.66183574879227,46.81122448979592],[155.94202898550725,697.1513605442177],[695.2415458937198,743.4098639455782],[660.1545893719806,118.46655328798185]],
[[109.80917874396135,60.416666666666664],[762.8164251207729,143.86337868480726],[179.33333333333331,785.1332199546486]],[[936.3019323671497,648.562393707483],[484.07004830917873,809.9116000566894]],[[283.94444444444446,832.9614866780046],[292.39130434782606,613.3809878117913],[998.0289855072464,604.8889243197278],[994.7801932367149,828.108878968254]],[[278.7463768115942,607.3152281746031],[279.3961352657005,836.6009424603175],[996.0797101449275,841.4535501700681],[988.9323671497584,598.8231646825396]]];
var dc1350=[780,820];
var isfirst = true;

var stair_num = 0;
var elevator_num = 0;
var exit_num = 0;
var neartim = false;
var nearprinter = false;
var nearbathroom = false;
var wakingdis = 0;
var keepinside = true;




$(document).ready(function() {
  canvas = document.getElementById("map");
  //cluearea = document.getElementById("clue");
  stage = new createjs.Stage(canvas);
  $("#Search_btn").on("click", search);
  $("#Finish_btn").on("click", submitroute);
  $("#map").on("click", clickMap);
  $("#submit_btn").on("click", submittoServer);
  $("#goup").on("click", upstairs);
  $("#godown").on("click", downstairs);
  $("#goexit").on("click", exitbuilding);
  $("#goenter").on("click", enterbuilding);
  var map = new createjs.Bitmap("/maps/map_colour.png");
  stage.addChild(map);
  map.image.onload = function() { stage.update(); };
  stage.update();
});


function submitroute(event){
  console.log("finish");
  var xhr = new XMLHttpRequest();
    xhr.open('POST', "/sendpath");
  xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function () { // 
    if (xhr.readyState == 4 && xhr.status == 200) {
        alert(xhr.responseText);
    }
  }
  $.each(data.data.paths, function (i, mypath){
    var lastx = 0;
    var lasty = 0;
    console.log(mypath);
    $.each(mypath, function(k, path){
      $.each(path.pointList, function(j, point){
        if(j == 0){
          lastx = point.x;
          lasty = point.y;
        }else{
          wakingdis += Math.sqrt((point.x - lastx)*(point.x - lastx) + (point.y - lasty)*(point.y - lasty));
          lastx = point.x;
          lasty = point.y;
        }
    });
    });
  });

  data.data.feature.push(stair_num);
  data.data.feature.push(elevator_num);
  data.data.feature.push(exit_num);
  data.data.feature.push(neartim);
  data.data.feature.push(nearprinter);
  data.data.feature.push(nearbathroom);
  data.data.feature.push(wakingdis);
  data.data.feature.push(keepinside);
  xhr.send(JSON.stringify(data));
  var map = new createjs.Bitmap("/maps/thankyou.png");
  map.y = 100;
  stage.removeAllChildren();
  stage.update();
  stage.addChild(map);
  map.image.onload = function() { stage.update(); };
  stage.update();
}

function submittoServer(event){
  var survey = [];
  var day = new Date();
  var myid = day.getTime();
  survey.push(myid);
  for(var i = 9; i < 21; i++){
    var results = document.getElementsByName("q"+i);
    var getN;
    for(var j = 0; j < results.length; j++){
      if(results[j].checked)
        getN = results[j].value;
    }
    survey.push(getN);
  }
  console.log("getn"+survey);
  var xhr = new XMLHttpRequest();
  xhr.open('POST', "/sendsurvey");
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.onreadystatechange = function () { // 
    if (xhr.readyState == 4 && xhr.status == 200) {
        alert(xhr.responseText);
    }
  }
  xhr.send(JSON.stringify(survey));
  console.log(myid);
  location.href="index.html?id="+myid;
}
function nearFacility(x, y, floor){
  $.each(tim_hortons[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        neartim = true;
    }
  });

  $.each(bathroom[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        nearbathroom = true;
    }
  });

  $.each(printer[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        nearprinter = true;
    }
  });
}

function canGoup(x, y, floor){
  nearlift = false;
  nearstair = false;
  $.each(stairsList[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        nearstair = true;
        //cluearea.innerHTML="You are close to the STAIRS, you can now click Up/Dn on the left side to go upstairs or downstairs.";
        return true;
    }
  });
  $.each(liftList[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        nearlift = true;
        //cluearea.innerHTML="You are close to the ELEVATOR, you can now click Up/Dn on the left side to go upstairs or downstairs.";
        return true;
    }
  });
  return false;
}

function canExit(x, y, floor){
  nearexit = false;
  nearhall = false;
  $.each(exitList[floor], function (i, pos){
    var distance = (pos[0]-x)*(pos[0]-x) + (pos[1]-y)*(pos[1]-y);
    if(distance <= 400){
        if(floor > 2 || (floor == 2 && curBuilding.valueOf() == "dc".valueOf())) nearhall=true;
        else nearexit = true;
        //cluearea.innerHTML="You are close to an EXIT of building "+curBuilding+" , you can now click Ex on the right side to exit the building.";

    }
  });
}

function downstairs(event){
  if(!(nearlift||nearstair) && !exited) return;
  var index = -1;
  var nextfloor = curFloor-1;
  $.each(data.data.paths, function (i, path) {
      $.each(path, function(i, apath){
        console.log(apath);
        if(apath.mapURL == "maps/"+curBuilding+nextfloor+".png".valueOf()){
          index = i;}
      });
  });
  if(index == -1){return;}
  curFloor -= 1;
  if(curFloor <= 0){
    curFloor += 1;
    return;
  }
  $("#stairs-dialog").dialog('close');
  drawAllPaths(data.data);
  if(nearlift)
    elevator_num += 1;
  else if(nearstair)
    stair_num += 1;
}

function upstairs(event){
  if(!(nearlift||nearstair) && !exited) return;
  var index = -1;
  var nextfloor = curFloor+1;
  $.each(data.data.paths, function (i, path) {
      $.each(path, function(i, apath){
        console.log(apath);
        if(apath.mapURL == "maps/"+curBuilding+nextfloor+".png".valueOf()){
          index = i;}
      });
  });
  if(index == -1){return;}
  curFloor += 1;
  if(curBuilding.valueOf() == "mc".valueOf()){
    if(curFloor > 4){
      curFloor -=1;
      return;
    }
  }else{
    if(curFloor > 3){
      curFloor-=1;
      return;
    }
  }
  $("#stairs-dialog").dialog('close');
  drawAllPaths(data.data);
  if(nearlift)
    elevator_num += 1;
  else if(nearstair)
    stair_num += 1;
}

function exitbuilding(event){
  if(!(nearexit||nearhall)) return;
  exited = false;
  var lastbuilding = curBuilding;
  var lastfloor = curFloor;
  if(curBuilding.valueOf() == "mc".valueOf()){
    if(curFloor == 1 || curFloor == 2){
      curBuilding = "dc";
      curFloor = 1;
    }else if(curFloor == 3 || curFloor == 4){
      curBuilding = "dc";
      curFloor -= 1;
    }
  }else{
    if(curFloor == 1){
      curBuilding = "mc";
      curFloor = 1;
    }else if(curFloor == 2 || curFloor == 3){
      curBuilding = "mc";
      curFloor += 1;
    }
  }
  var index = -1;
  $.each(data.data.paths, function (i, path) {
      $.each(path, function(i, apath){
        console.log(apath);
        if(apath.mapURL == "maps/"+curBuilding+curFloor+".png".valueOf()){
          index = i;}
      });
  });
  if(index == -1){
    curBuilding = lastbuilding;
    curFloor = lastfloor;
    return;
  }
  $("#exit-dialog").dialog('close');
  //cluearea.innerHTML="You have now exited Floor "+lastfloor+" of "+lastbuilding+" building. Now you are presented the Entrance on Floor "+ curFloor + " of "+curBuilding+" building! If this is not the Entrance you expected, please keep the Up/Dn buttons to adjust the floor levels. If you want to enter this entrance, please click on the En button on the right."
  drawAllPaths(data.data);
  if(nearexit) {exit_num += 1; keepinside=false;}
}

function enterbuilding(event){
  exited = false;
  //cluearea.innerHTML="You have now entered Floor"+curFloor+" of "+curBuilding+" building. Please click on the map to record you route!";
  $("#exit-dialog").dialog('close');
  newpoint(event);
}

function clickMap(event) {
    console.log("click map");
    console.log(data);
    event.preventDefault = true;
    var xx = event.clientX;
    var yy = event.clientY;
    var pt = stage.globalToLocal(xx, yy);
    pt.x = stage.mouseX;
    pt.y = stage.mouseY;
    var myindex = (curBuilding.valueOf() == "mc".valueOf())? -1:3;
    myindex += curFloor;
    canGoup(pt.x, pt.y, myindex);
    canExit(pt.x, pt.y, myindex);
    nearFacility(pt.x, pt.y, myindex);
    if(nearlift||nearstair){
      $("#stairs-dialog").dialog({position: {of:event}});
    }
    if(nearexit || nearhall){
      $("#exit-dialog").dialog({position: {of:event}});
      $("#exit-dialog").dialog("option", "position", {of: event});
    }
  newpoint(event);
}

function newpoint(event) {
  if(exited)  return;
  console.log("newpoint");
    var pt = {x:stage.mouseX, y:stage.mouseY};
    if(isfirst){
      var distance = (dc1350[0]-pt.x)*(dc1350[0]-pt.x) + (dc1350[1]-pt.y)*(dc1350[1]-pt.y);
      if(distance > 500)
        return;
    }
    isfirst = false;
    // var arrlen = data.data.paths[0].length;
    // data.data.paths[0][arrlen-1].pointList.push(pt);
    // var myindex = (curBuilding.valueOf() == "mc".valueOf())? -1:3;
    // myindex += curFloor;
    // canGoup(pt.x, pt.y, myindex);
    // canExit(pt.x, pt.y, myindex);
    // console.log(data.data);
    drawAllPaths(data.data);
}

function search(event) {
  var sbuilding = $("#startBui").val();
  var sroom = $("#startRoom").val();
  var ebuilding = $("#endBui").val();
  var eroom = $("#endRoom").val();
  curBuilding = sbuilding;
  curFloor = parseInt(sroom.substring(0,1));
  if(curBuilding.valueOf() == "00".valueOf() || curFloor.valueOf() == "0".valueOf()){
    return;
  }
  var mid = document.URL.slice(-2);
  mid = mid.replace("=","");
  console.log("in search"+mid);
  data = dataset[parseInt(mid)];
  console.log(data.data);
  drawAllPaths(data.data);
  console.log(document.URL);
}

function drawAllPaths(data) {
  console.log(data.paths);
  stage.removeAllChildren();
  stage.update();
  $.each(data.paths, function (i, path) {
      drawPath(stage, i, path);
  });
  stage.update();
}

function drawPath(stage, indexOfpath, path) {
//  console.log("I am INDEX"+indexOfpath);
//  console.log(path);
  var lastPoint;
  var offset = {x: 0, y: 0};
  var line = new createjs.Shape();
  var circle = new createjs.Shape();
  line.graphics.setStrokeStyle(4).beginStroke("grey");
  var index = -1;
  $.each(path, function(i, apath){
    console.log(apath);
    if(apath.mapURL == "maps/"+curBuilding+curFloor+".png".valueOf()){
      index = i;
    }
  });
  if(index == -1)
    return;
  var segment = path[index];
  var mapURL = segment.mapURL;
    //var width = segment.mapWidth;
    //var height = segment.mapHeight;
    if(curBuilding.valueOf() == "mc".valueOf())
      canvas.height=800;
    else
      canvas.height=1070;
    var pointList = segment.pointList;
    var map = new createjs.Bitmap(mapURL);
    stage.addChild(map);
    map.image.onload = function() { stage.update(); };
    //console.log(mapURL);
    //console.log(pointList);
    $.each(pointList, function (j, point) {
      //console.log(point);
      var footprint = new createjs.Bitmap(footprinturl);
      footprint.x = point.x+10;
      footprint.y = point.y+10;
      footprint.regX = 30;
      footprint.regY = 30;
      //circle.graphics.beginFill("blue").drawCircle(point.x-10, point.y-10, 15);
      drawSegment(line.graphics, offset, lastPoint, point);
      stage.addChild(footprint);
      lastPoint = point;
    });
    //drawStairs(circle);
    //stage.addChild(circle);
    stage.addChild(line);
    $.each(pointList, function (j, point) {
      //console.log(point);
      var footprint = new createjs.Bitmap(footprinturl);
      footprint.x = point.x+10;
      footprint.y = point.y+10;
      footprint.regX = 30;
      footprint.regY = 30;
      stage.addChild(footprint);
      footprint.image.onload = function(){stage.update(); };
      console.log("in pointList:"+j)
    });
    stage.update();
}

function drawSegment(graphics, offset, pStart, pEnd) {
  if (!pStart) return;
  graphics.moveTo(pStart.x + offset.x, pStart.y + offset.y);
  graphics.lineTo(pEnd.x + offset.x, pEnd.y + offset.y);
}

function drawStairs(circle){
  var myindex = (curBuilding.valueOf() == "mc".valueOf())? -1:3;
  myindex += curFloor;
 // console.log(myindex);
 // console.log(stairsList[myindex]);
  $.each(stairsList[myindex], function (i, pos){
    circle.graphics.beginFill("red").drawCircle(pos[0],pos[1],10);
  });
  $.each(liftList[myindex], function (i, pos){
    circle.graphics.beginFill("yellow").drawCircle(pos[0],pos[1],10);
  });
  $.each(exitList[myindex], function (i, pos){
    circle.graphics.beginFill("green").drawCircle(pos[0],pos[1],10);
  });
  if(curFloor == 1 && curBuilding.valueOf() == "dc")
    circle.graphics.beginFill("blue").drawRect(dc1350[0], dc1350[1], 20,20);
}
